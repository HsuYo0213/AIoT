<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>功課1 - 線性回歸範例</title>

  <!-- Plotly Library -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <style>
    body {
      font-family: 'Noto Sans TC', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
    }

    .container {
      max-width: 800px;
      margin-top: 50px;
    }

    #plot {
      width: 100%;
      height: 500px;
      margin-top: 20px;
    }

    .btn-container {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
    }

    .dark-mode {
      background-color: #212529;
      color: white;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>功課1 - 線性回歸範例</h1>

    <!-- Plotly Plot -->
    <div id="plot"></div>

    <!-- Metrics Section -->
    <div class="mt-4">
      <p><strong>Mean Squared Error (MSE):</strong> <span id="mse"></span></p>
      <p><strong>R² Score:</strong> <span id="r2"></span></p>
    </div>

    <!-- Buttons: Back and Dark Mode -->
    <div class="btn-container">
      <button class="btn btn-primary" onclick="goBack()">返回上一頁</button>
      <button id="darkModeToggle" class="btn btn-secondary">切換夜間模式</button>
    </div>
  </div>

  <script>
    // Data Generation: X and y points
    const X = Array.from({ length: 100 }, () => Math.random() * 2);
    const y = X.map(x => 4 + 3 * x + Math.random());

    // Linear Regression Calculation
    let n = X.length;
    let sumX = X.reduce((a, b) => a + b, 0);
    let sumY = y.reduce((a, b) => a + b, 0);
    let sumXY = X.map((xi, i) => xi * y[i]).reduce((a, b) => a + b, 0);
    let sumX2 = X.map(xi => xi * xi).reduce((a, b) => a + b, 0);

    let slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX ** 2);
    let intercept = (sumY - slope * sumX) / n;

    // Predicted Line Calculation
    const xLine = [0, 2];
    const yLine = xLine.map(x => intercept + slope * x);

    // Plotting with Plotly
    const trace1 = { x: X, y: y, mode: 'markers', type: 'scatter', name: 'Data Points' };
    const trace2 = { x: xLine, y: yLine, mode: 'lines', name: 'Regression Line' };
    const layout = { 
      title: 'Linear Regression Example', 
      xaxis: { title: 'X' }, 
      yaxis: { title: 'Y' } 
    };
    Plotly.newPlot('plot', [trace1, trace2], layout);

    // Calculate Metrics: MSE and R²
    function calculateMetrics(X, Y) {
      const predictions = X.map(x => slope * x + intercept);
      const mse = predictions.reduce((sum, pred, i) => sum + (Y[i] - pred) ** 2, 0) / X.length;
      const meanY = Y.reduce((a, b) => a + b, 0) / Y.length;
      const r2 = 1 - predictions.reduce((sum, pred, i) => sum + (Y[i] - pred) ** 2, 0) /
                        Y.reduce((sum, y) => sum + (y - meanY) ** 2, 0);
      return { mse, r2 };
    }

    // Display Metrics
    const metrics = calculateMetrics(X, y);
    document.getElementById('mse').textContent = metrics.mse.toFixed(2);
    document.getElementById('r2').textContent = metrics.r2.toFixed(2);

    // Dark Mode Toggle
    document.getElementById('darkModeToggle').addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
    });

    // Go Back Function
    function goBack() {
      window.history.back();
    }
  </script>

</body>
</html>
